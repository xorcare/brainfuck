package interpreter

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestPrepare(t *testing.T) {
	tests := []struct {
		have string
		want string
	}{
		{
			have: "+",
			want: "+",
		},
		{
			have: "+[-]",
			want: "+[-]",
		},
		{
			have: "++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[-]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.",
			want: "++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[-]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.",
		},
		{
			have: "+++++++++++++[->++>>>+++++>++>+<<<<<<]>>>>>++++++>--->>>>>>>>>>+++++++++++++++",
			want: "+++++++++++++[->++>>>+++++>++>+<<<<<<]>>>>>++++++>--->>>>>>>>>>+++++++++++++++",
		},
		{
			have: "++++++>>[-<<<<+>>>>]<<<<[->>>>+<<[-]<<]>>[<<<<<<<+<[-<+>>>>+<<[-]]>",
			want: "++++++>>[-<<<<+>>>>]<<<<[->>>>+<<[-]<<]>>[<<<<<<<+<[-<+>>>>+<<[-]]>",
		},
		{
			have: "++++++>>[-<<<<+>>>>]<<<<[->>>>+<<[-]<<]>>[<<<<<<<+<[-<+>>>>+<<[-]]>]",
			want: "++++++>>[-<<<<+>>>>]<<<<[->>>>+<<[-]<<]>>[<<<<<<<+<[-<+>>>>+<<[-]]>]",
		},
		{
			have: "->>>>>>>>>#<<<<<<<<<",
			want: "->>>>>>>>><<<<<<<<<",
		},
		{
			have: "->>>>>>>>>$<<<<<<<<<\n",
			want: "->>>>>>>>><<<<<<<<<",
		},
		{
			have: "[[[[[[[[[[[[[[[[]",
			want: "[[[[[[[[[[[[[[[[]",
		},
		{
			have: "[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]",
			want: "[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]",
		},
		{
			have: ",----------[----------------------.,----------]",
			want: ",----------[----------------------.,----------]",
		},
		{
			have: ",----------[----------------------.,----------]",
			want: ",----------[----------------------.,----------]",
		},
	}
	for _, tt := range tests {
		t.Run(tt.have, func(t *testing.T) {
			got, err := Prepare(bytes.NewBufferString(tt.have))
			require.NoError(t, err)
			require.Equal(t, tt.want, got.String())
		})
	}
}
